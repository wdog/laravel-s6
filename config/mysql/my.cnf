[mysqld]
# Basic Settings
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
default-storage-engine = InnoDB

# Memory Allocation (adjust based on available Docker container memory)
innodb_buffer_pool_size = 2G
innodb_buffer_pool_instances = 4
sort_buffer_size = 2M
read_buffer_size = 2M
read_rnd_buffer_size = 4M
join_buffer_size = 2M
tmp_table_size = 128M
max_heap_table_size = 128M

# INSERT Performance Optimizations
innodb_flush_log_at_trx_commit = 0  # Fastest for inserts (risk: 1s data loss)
innodb_redo_log_capacity = 1G  # Replaces innodb_log_file_size in MySQL 8.0.30+
innodb_log_buffer_size = 64M
innodb_write_io_threads = 8
innodb_read_io_threads = 8
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000

# Batch INSERT optimizations
bulk_insert_buffer_size = 64M
innodb_autoinc_lock_mode = 2  # Interleaved lock mode for better concurrency

# Connection Management
max_connections = 300
thread_cache_size = 100
max_connect_errors = 100000

# Binary Logging (disable if not needed for replication)
skip-log-bin  # Comment out if you need binary logging
# sync_binlog = 0  # Use if binary logging is enabled

# File and Table Settings
max_allowed_packet = 256M
innodb_file_per_table = 1
innodb_open_files = 4000
table_open_cache = 4000
table_definition_cache = 2000

# Timeout Settings
innodb_lock_wait_timeout = 120
wait_timeout = 300
interactive_timeout = 300

# Logging (adjust for production)
log-error-verbosity = 2
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 5  # Increased for INSERT-heavy workloads

# Performance Schema (can disable for better performance)
performance_schema = OFF

# MySQL 8.0+ Specific Optimizations
innodb_dedicated_server = OFF  # Set to ON if MySQL is the only service
innodb_undo_log_truncate = ON
innodb_max_undo_log_size = 1G

# Authentication (MySQL 8.4+ changes)
# mysql_native_password is deprecated in 8.4, disabled by default
# Use caching_sha2_password (default) or enable native password if needed:
# mysql-native-password = ON  # Uncomment only if you need legacy compatibility

# Disable unnecessary features for INSERT performance
innodb_doublewrite = OFF  # Risk: potential corruption on crashes

# Additional INSERT optimizations
innodb_flush_method = O_DIRECT  # Skip OS buffer cache for data files
innodb_adaptive_hash_index = ON  # Can help with repeated queries
innodb_thread_concurrency = 0   # Let InnoDB manage thread scheduling

# Memory optimization
key_buffer_size = 32M  # Small since we're using InnoDB
myisam_sort_buffer_size = 8M

[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4
